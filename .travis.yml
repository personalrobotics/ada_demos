dist: trusty

sudo: required

language: generic

env:
  global:
    - TIMEOUT=30

cache:
  - apt

matrix:
  include:
    - os: linux
      compiler: gcc
      env: BUILD_TYPE=Debug CATKIN_CONFIG_OPTIONS="-DCMAKE_BUILD_TYPE=Debug"
    - os: linux
      compiler: gcc
      env: BUILD_TYPE=Release CATKIN_CONFIG_OPTIONS="-DCMAKE_BUILD_TYPE=Release"

# Install test fixture dependencies.
before_install:
  - mkdir -p "${HOME}/workspace/src"
  - cd "${HOME}/workspace"
  - git clone https://github.com/personalrobotics/pr-cleanroom.git scripts
  - curl -sS "${DISTRIBUTION}" | ./scripts/internal-convert.py > distribution.yml # internal-convert.py is required as this repo is private; please remove it once becomes public
  - ./scripts/internal-setup.sh
  - export PACKAGE_NAMES="$(./scripts/internal-get-packages.py distribution.yml ${REPOSITORY})"

install:
  - mv "${TRAVIS_BUILD_DIR}" src
  - ./scripts/internal-distro.py --workspace=src distribution.yml --repository "${REPOSITORY}"

script:
  - ./scripts/internal-build.sh ${PACKAGE_NAMES}
  - ./scripts/internal-test.sh ${PACKAGE_NAMES}
  # Check code style
  - ./scripts/internal-run.sh catkin build --no-status --no-deps -p 1 -i --make-args check-format -- herb3_demos

after_failure:
  - cat ./build/herb3_demos/Testing/Temporary/LastTest.log
  - cat ./build/herb3_demos/Testing/Temporary/LastTestsFailed.log
